# Documentation for the `sas_dataset_json` package.
  
----------------------------------------------------------------
 
 *sas_dataset_json--Provides various macros related to support bi-directional conversion between Dataset-JSON forma(version 1.1)t and SAS datasets.* 
  
----------------------------------------------------------------
 
### Version information:
  
- Package: sas_dataset_json
- Version: 0.2.0
- Generated: 2025-08-13T03:22:34
- Author(s): Yutaka Morioka(sasyupi@gmail.com)
- Maintainer(s): Yutaka Morioka(sasyupi@gmail.com)
- License: MIT
- File SHA256: `F*F622A6309D74808B6FDD403667A67F74055DD7A6944EEC6420083D0C8B389A82` for this version
- Content SHA256: `C*0E4E65ED5864D4F23FFEBD8A4C5223F7771982538FDD5122AFD721390053BF94` for this version
  
---
 
# The `sas_dataset_json` package, version: `0.2.0`;
  
---
 
sas_dataset_json is a SAS macro package designed to support bi-directional conversion between CDISC-compliant dataset-JSON format and SAS datasets.
Key Features:
Export SAS datasets to dataset-JSON
Automatically extracts metadata such as labels, data types, lengths, and formats
Supports SAS Extended Attributes to override default metadata values
(e.g., dataType, displayFormat, label, targetDataType, etc.)
Outputs in strict compliance with dataset-JSON v1.1
Import dataset-JSON into SAS datasets
Parses metadata and records from JSON to reconstruct SAS datasets
  
---
 
  
---
 
Required SAS Components: 
  - Base SAS Software
  
---
 
 
--------------------------------------------------------------------
 
*SAS package generated by SAS Package Framework, version `20241207`*
 
--------------------------------------------------------------------
 
# The `sas_dataset_json` package content
The `sas_dataset_json` package consists of the following content:
 
1. [`mylib1` libname ](#mylib1-libname-1 )
2. [`adsl` data ](#adsl-data-2 )
3. [`%m_json1_1_to_sas()` macro ](#mjson11tosas-macros-3 )
4. [`%m_ndjson1_1_to_sas()` macro ](#mndjson11tosas-macros-4 )
5. [`%m_sas_to_json1_1()` macro ](#msastojson11-macros-5 )
6. [`%m_sas_to_ndjson1_1()` macro ](#msastondjson11-macros-6 )
  
 
7. [License note](#license)
  
---
 
## `mylib1` libname <a name="mylib1-libname-1"></a> ######

Create mylib library under work directory.

  
---
 
## `adsl` data <a name="adsl-data-2"></a> ######

[Sample data] dummy-adsl

  
---
 
## `%m_json1_1_to_sas()` macro <a name="mjson11tosas-macros-3"></a> ######

Macro Name    : %m_json1_1_to_sas
  Description   : Imports CDISC-compliant dataset-JSON v1.1 into a 
                   SAS dataset, reconstructing structure and metadata including extended attributes.

  Key Features:
    - Reads dataset-JSON using the FILENAME and JSON LIBNAME engine
    - Extracts "root", "columns", and "rows" objects from JSON
    - Dynamically generates:
        - LABEL, FORMAT, and RENAME statements
        - INPUT conversion logic for ISO8601 date/datetime types
    - Automatically applies:
        - Dataset-level metadata via PROC DATASETS and XATTR
        - Variable-level extended attributes such as:
            - dataType
            - targetDataType
            - displayFormat
            - keySequence
            - length
    - Provides warnings for unsupported data types (e.g., decimal)

  Parameters:
    inpath : Path to the folder containing the dataset-JSON file
    ds     : SAS dataset name to create (derived from the file name)

  Requirements:
    - SAS 9.4M5 or later (for JSON LIBNAME engine and extended attributes)
    - Input JSON must follow the dataset-JSON v1.1 specification

  Notes:
    - "decimal" targetDataType is not natively supported in SAS;
      values are read as numeric using the `best.` format with a warning
    - Date and datetime values are parsed using `E8601DA.` and `E8601DT.` formats
    - Extended metadata attributes are added using PROC DATASETS/XATTR

  Example Usage:
    %m_json1_1_to_sas(inpath=/data/definejson, ds=AE);


  Author         : [Yutaka Morioka]
  Created Date   : [2025-05-23]
  Past update Date   : [2025-06-23] -- initialize keySequence (0.13)
  Last update Date   : [2025-08-13] --  
   Setting the length of the dataset from dataset-json when the type is string.
   Bug fix for when the variable label in dataset-json is null  (0.20)

  Version        : 0.20
  License        : MIT License

  
---
 
## `%m_ndjson1_1_to_sas()` macro <a name="mndjson11tosas-macros-4"></a> ######

Macro Name    : %m_ndjson1_1_to_sas
  Description   : Imports CDISC-compliant NDJSON (Representation of Dataset-JSON) format (version 1.1) into a 
                   SAS dataset, reconstructing structure and metadata including extended attributes.

  Key Features:
	- Convert ndjson to dataset-json once internally
    - Reads dataset-JSON using the FILENAME and JSON LIBNAME engine
    - Extracts "root", "columns", and "rows" objects from JSON
    - Dynamically generates:
        - LABEL, FORMAT, and RENAME statements
        - INPUT conversion logic for ISO8601 date/datetime types
    - Automatically applies:
        - Dataset-level metadata via PROC DATASETS and XATTR
        - Variable-level extended attributes such as:
            - dataType
            - targetDataType
            - displayFormat
            - keySequence
            - length
    - Provides warnings for unsupported data types (e.g., decimal)

  Parameters:
    inpath : Path to the folder containing the dataset-JSON file
    ds     : SAS dataset name to create (derived from the file name)

  Requirements:
    - SAS 9.4M5 or later (for JSON LIBNAME engine and extended attributes)
    - Input JSON must follow the dataset-JSON v1.1 specification

  Notes:
    - "decimal" targetDataType is not natively supported in SAS;
      values are read as numeric using the `best.` format with a warning
    - Date and datetime values are parsed using `E8601DA.` and `E8601DT.` formats
    - Extended metadata attributes are added using PROC DATASETS/XATTR

  Example Usage:
    %m_ndjson1_1_to_sas(inpath=/data/definejson, ds=AE);

  Author         : [Yutaka Morioka]
  Created Date   : [2025-06-23]
  Last update Date   : [2025-08-13] --  
   Setting the length of the dataset from dataset-json when the type is string.
   Bug fix for when the variable label in dataset-json is null  (0.20)
  Version        : 0.20
  License        : MIT License

  
---
 
## `%m_sas_to_json1_1()` macro <a name="msastojson11-macros-5"></a> ######

Macro Name    : %m_sas_to_json1_1
  Description   : Exports a SAS dataset to Dataset-JSON 
                  format (version 1.1). This macro is designed to
                  support clinical data interchange by generating

  Purpose       : 
    - To convert a SAS dataset into a structured Dataset-JSON format(version 1.1) .
    - Automatically extracts metadata such as labels, data types, formats,
      and extended attributes if defined.
    - Generates a metadata-rich datasetJSON with customizable elements.

  Input Parameters:
    outpath               : Path to output directory (default: WORK directory).
    library               : Library reference for input dataset (default: WORK).
    dataset               : Name of the input dataset (required).
    pretty                : Whether to pretty-print the JSON (Y/N, default: Y).
    originator            : Organization or system creating the file (optional).
    fileOID               : File OID to uniquely identify the JSON (optional).
    studyOID              : Study OID used in the Define-XML reference (optional).
    metaDataVersionOID    : Metadata version OID (optional).
    sourceSystem_name     : Source system name (default: SAS on &SYSSCPL.).
    sourceSystem_version  : Source system version (default: from &SYSVLONG).

  Features:
    - Automatically detects and prioritizes extended attributes for variables.
    - Captures dataset-level metadata such as label and last modified date.
    - Outputs structured "columns" and "rows" sections per dataset-JSON v1.1.0.

  Dependencies:
    - Requires access to `sashelp.vxattr`, `sashelp.vcolumn`, and `sashelp.vtable`.
    - Uses PROC JSON, PROC SQL, PROC CONTENTS, and extended attribute inspection.

  Notes:
    - Extended variable attributes (label, type, format, etc.) override defaults.
    - All variables are output with detailed metadata including data types,
      display formats, and lengths.
    - Output file is saved as "&outpath.\&dataset..json".

  Example Usage:

- [case 1] default, simple use
%m_sas_to_json1_1(outpath =/project/json_out,
                 library = adam,
                 dataset = adsl,
                 pretty = Y
);

- [case 2] setting dataset-level metadata
    %m_sas_to_json1_1(
      outpath=/project/json_out,
      library=SDTM,
      dataset=AE,
      pretty=Y,
      originator=ABC Pharma,
      fileOID=http://example.org/studyXYZ/define,
      studyOID=XYZ-123,
      metaDataVersionOID=MDV.XYZ.1.0,
      sourceSystem_name=SAS 9.4,
      sourceSystem_version=9.4M7
    );

- [case 3] set metadata by SAS extended attribute
proc datasets nolist;                             
   modify adsl;     
   xattr add ds originator="X corp."
                    fileOID="www.cdisc.org/StudyMSGv2/1/Define-XML_2.1.0/2024-11-11/"
          					studyOID="XX001-001"
          					metaDataVersionOID="MDV.MSGv2.0.SDTMIG.3.4.SDTM.2.0"
                    sourceSystem_name="SASxxxx"
                    sourceSystem_version="9.4xxxx"
	;  
   xattr add var 
                    STUDYID (label="Study Identifier"
                                 dataType="string"
                                 length=8
                                 keySequence=1) 
                    USUBJID (label="Unique Subject Identifier"
                                 dataType="string"
                                 length=7
                                 keySequence=2) 
                    RFSTDTC (label="Subject Reference Start Date/Time"
                                 dataType="date")
                    AGE (label="Age"
                           dataType="integer"
                           length=2)
                    TRTSDT (label="Date of First Exposure to Treatment"
                           dataType="date"
                           targetDataType="integer"
                           displayFormat="E8601DA.")

 ;

; 
run;
quit;
 %m_sas_to_json1_1(outpath = /project/json_out,
                 library = WORK,
                 dataset = adsl,
                 pretty = Y
);

Required SAS 9.4 and above

  Author         : [Yutaka Morioka]
  Created Date   : [2025-05-22]
  Past update Date   : [2025-05-23] -- delete ITEMGROUPDATASEQ 
  Past update Date   : [2025-05-25] -- modified to not output data attributes with empty definitions.
  Past update Date   : [2025-06-23] -- apply the e8601DT format to the LastModifiedDateTime
  Last update Date   : [2025-08-13] --  
    When the E8601TM format is applied, set dataType = "date" and targetDataType = "integer". However, specifications in extended attributes take precedence.  (0.20)

  Version        : 0.20
  License        : MIT License

  
---
 
## `%m_sas_to_ndjson1_1()` macro <a name="msastondjson11-macros-6"></a> ######

Macro Name    : %m_sas_to_ndjson1_1
  Description   : Exports a SAS dataset to NDJSON (Representation of Dataset-JSON) 
                  format (version 1.1). This macro is designed to
                  support clinical data interchange by generating

  Purpose       : 
    - To convert a SAS dataset into a structured NDJSON format(subset of Dataset-JSON version 1.1) .
    - Automatically extracts metadata such as labels, data types, formats,
      and extended attributes if defined.
    - Generates a metadata-rich datasetJSON with customizable elements.

  Input Parameters:
    outpath               : Path to output directory (default: WORK directory).
    library               : Library reference for input dataset (default: WORK).
    dataset               : Name of the input dataset (required).
    originator            : Organization or system creating the file (optional).
    fileOID               : File OID to uniquely identify the JSON (optional).
    studyOID              : Study OID used in the Define-XML reference (optional).
    metaDataVersionOID    : Metadata version OID (optional).
    sourceSystem_name     : Source system name (default: SAS on &SYSSCPL.).
    sourceSystem_version  : Source system version (default: from &SYSVLONG).

  Features:
    - Automatically detects and prioritizes extended attributes for variables.
    - Captures dataset-level metadata such as label and last modified date.
    - Outputs structured "columns" and rows part sections per dataset-JSON v1.1.0.

  Dependencies:
    - Requires access to `sashelp.vxattr`, `sashelp.vcolumn`, and `sashelp.vtable`.
    - Uses PROC JSON, PROC SQL, PROC CONTENTS, and extended attribute inspection.

  Notes:
    - Extended variable attributes (label, type, format, etc.) override defaults.
    - All variables are output with detailed metadata including data types,
      display formats, and lengths.
    - Output file is saved as "&outpath.\&dataset..ndjson".

  Example Usage:

- [case 1] default, simple use
%m_sas_to_ndjson1_1(outpath =/project/json_out,
                 library = adam,
                 dataset = adsl,
);

- [case 2] setting dataset-level metadata
    %m_sas_to_ndjson1_1(
      outpath=/project/json_out,
      library=SDTM,
      dataset=AE,
      originator=ABC Pharma,
      fileOID=http://example.org/studyXYZ/define,
      studyOID=XYZ-123,
      metaDataVersionOID=MDV.XYZ.1.0,
      sourceSystem_name=SAS 9.4,
      sourceSystem_version=9.4M7
    );

- [case 3] set metadata by SAS extended attribute
proc datasets nolist;                             
   modify adsl;     
   xattr add ds originator="X corp."
                    fileOID="www.cdisc.org/StudyMSGv2/1/Define-XML_2.1.0/2024-11-11/"
          					studyOID="XX001-001"
          					metaDataVersionOID="MDV.MSGv2.0.SDTMIG.3.4.SDTM.2.0"
                    sourceSystem_name="SASxxxx"
                    sourceSystem_version="9.4xxxx"
	;  
   xattr add var 
                    STUDYID (label="Study Identifier"
                                 dataType="string"
                                 length=8
                                 keySequence=1) 
                    USUBJID (label="Unique Subject Identifier"
                                 dataType="string"
                                 length=7
                                 keySequence=2) 
                    RFSTDTC (label="Subject Reference Start Date/Time"
                                 dataType="date")
                    AGE (label="Age"
                           dataType="integer"
                           length=2)
                    TRTSDT (label="Date of First Exposure to Treatment"
                           dataType="date"
                           targetDataType="integer"
                           displayFormat="E8601DA.")

 ;

; 
run;
quit;
 %m_sas_to_ndjson1_1(outpath = /project/json_out,
                 library = WORK,
                 dataset = adsl,
);

Required SAS 9.4 and above

  Author         : [Yutaka Morioka]
  Created Date   : [2025-06-23]
  Last update Date   : [2025-08-13] --  
    When the E8601DT format is applied, set dataType = "date" and targetDataType = "integer". However, specifications in extended attributes take precedence.  
    Added escape processing when double quotation marks are included in data.
  Version        : 0.20 
  License        : MIT License

  
---
 
  
---
 
# License <a name="license"></a> ######
 
Copyright (c) [2025] [Yutaka Morioka]
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
  
---
 
